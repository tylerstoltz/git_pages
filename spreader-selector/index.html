<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stoltzfus Spreader Selector Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background-color: #252526;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #3e3e42;
        }

        .header h1 {
            color: #569cd6;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            color: #9cdcfe;
            margin-bottom: 10px;
        }

        .back-link {
            display: inline-block;
            color: #4ec9b0;
            text-decoration: none;
            margin-top: 10px;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .section {
            background-color: #252526;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #3e3e42;
        }

        .section h2 {
            color: #4ec9b0;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #9cdcfe;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 10px;
            background-color: #1e1e1e;
            color: #d4d4d4;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #569cd6;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .btn {
            background-color: #569cd6;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #4a8bc2;
        }

        .btn:active {
            background-color: #3d7aad;
        }

        .results {
            display: none;
        }

        .results.active {
            display: block;
        }

        .spreader-card {
            background-color: #2d2d30;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #569cd6;
        }

        .spreader-card.top-match {
            border-left-color: #4ec9b0;
            background-color: #1a3a1a;
        }

        .spreader-card h3 {
            color: #4ec9b0;
            font-size: 1.4em;
            margin-bottom: 10px;
        }

        .match-score {
            display: inline-block;
            background-color: #4ec9b0;
            color: #1e1e1e;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 10px;
            font-size: 0.9em;
        }

        .spreader-card .category {
            color: #c586c0;
            font-style: italic;
            margin-bottom: 10px;
        }

        .specs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .spec-item {
            color: #d4d4d4;
        }

        .spec-label {
            color: #9cdcfe;
            font-weight: bold;
        }

        .features {
            margin-top: 15px;
        }

        .features-title {
            color: #dcdcaa;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .features ul {
            list-style: none;
            padding-left: 0;
        }

        .features li {
            color: #ce9178;
            padding: 4px 0;
            padding-left: 20px;
            position: relative;
        }

        .features li:before {
            content: "‚Ä¢";
            color: #4ec9b0;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #9cdcfe;
        }

        .reset-btn {
            background-color: #3e3e42;
            margin-left: 10px;
        }

        .reset-btn:hover {
            background-color: #505054;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöú Stoltzfus Spreader Selector</h1>
            <p>Find the perfect spreader for your farm operation</p>
            <p style="font-size: 0.9em; color: #858585;">Answer a few questions about your needs, and we'll recommend the best Stoltzfus spreader models for you.</p>
            <a href="../" class="back-link">‚Üê Back to Tools</a>
        </div>

        <div class="section">
            <h2>Your Requirements</h2>
            <form id="spreaderForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="farmSize">Farm Size (acres)</label>
                        <select id="farmSize">
                            <option value="">Select...</option>
                            <option value="small">Small (0-50 acres)</option>
                            <option value="medium">Medium (50-200 acres)</option>
                            <option value="large">Large (200-500 acres)</option>
                            <option value="xlarge">Very Large (500+ acres)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="material">Primary Material to Spread</label>
                        <select id="material">
                            <option value="">Select...</option>
                            <option value="lime">Lime (dry or wet)</option>
                            <option value="fertilizer">Fertilizer</option>
                            <option value="chicken-litter">Chicken Litter / Poultry Litter</option>
                            <option value="compost">Compost</option>
                            <option value="manure">Manure</option>
                            <option value="gypsum">Gypsum</option>
                            <option value="biochar">Biochar</option>
                            <option value="seeds">Cover Crop Seeds</option>
                            <option value="bulk">Bulk Materials</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="capacity">Capacity Needed</label>
                        <select id="capacity">
                            <option value="">Select...</option>
                            <option value="small">Small (2-4 tons)</option>
                            <option value="medium">Medium (4-8 tons)</option>
                            <option value="large">Large (8-15 tons)</option>
                            <option value="xlarge">Very Large (15-20 tons)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="driveType">Drive Type Preference</label>
                        <select id="driveType">
                            <option value="">No Preference</option>
                            <option value="pto">PTO Driven</option>
                            <option value="hydraulic">Hydraulic Drive</option>
                            <option value="ground">Ground Driven</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="cropType">Farm Type / Special Requirements</label>
                        <select id="cropType">
                            <option value="">General Agriculture</option>
                            <option value="row-crop">Row Crop (need adjustable wheel track)</option>
                            <option value="orchard">Orchard / Vineyard (need narrow profile)</option>
                            <option value="wet-conditions">Wet Conditions / Wet Lime</option>
                            <option value="boom-spreader">Boom Spreader (specialty precision spreading)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="budget">Budget Range</label>
                        <select id="budget">
                            <option value="">No Preference</option>
                            <option value="economy">Economy</option>
                            <option value="mid">Mid-Range</option>
                            <option value="premium">Premium / Custom</option>
                        </select>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <button type="submit" class="btn">Find My Spreader</button>
                    <button type="button" class="btn reset-btn" onclick="resetForm()">Reset</button>
                </div>
            </form>
        </div>

        <div id="results" class="section results">
            <h2>Recommended Spreaders</h2>
            <div id="resultsContainer"></div>
        </div>
    </div>

    <script>
        // Comprehensive spreader database
        const spreaders = [
            // WC / RCB Boom Spreaders - ONLY shown when "Boom Spreader" is selected
            {
                name: "WC-5 Ton",
                category: "W-Chain Boom Spreader",
                capacity: 5,
                capacityCuFt: 155,
                materials: ["lime", "fertilizer", "chicken-litter", "compost", "gypsum", "bulk"],
                driveType: "hydraulic",
                features: [
                    "W-Chain boom technology",
                    "155 cu. ft. hopper volume",
                    "Specialty product for precision spreading",
                    "Hydraulic-driven boom system",
                    "96 in. hopper length, 78 in. width",
                    "11L x 15, 8 ply tires"
                ],
                farmSize: ["small", "medium"],
                specialUse: ["boom-spreader"],
                budgetClass: "premium",
                boomSpreaderOnly: true
            },
            {
                name: "RCB-80 8 Ton",
                category: "RCB Row Crop Boom Spreader",
                capacity: 8,
                capacityCuFt: 242,
                materials: ["lime", "fertilizer", "chicken-litter", "compost", "gypsum", "biochar"],
                driveType: "pto",
                features: [
                    "Row crop boom spreader technology",
                    "242 cu. ft. hopper volume",
                    "Precision spreading for row crops",
                    "120 in. hopper length, 93 in. width",
                    "19L x 16.1, 10 ply tires",
                    "Heavy-duty construction"
                ],
                farmSize: ["medium", "large"],
                specialUse: ["boom-spreader", "row-crop"],
                budgetClass: "premium",
                boomSpreaderOnly: true
            },
            // CU / Redhawk Series - Ground Drive Spreaders
            {
                name: "CU 40",
                category: "CU / Redhawk Ground Drive Spreader",
                capacity: 4,
                capacityCuFt: 85,
                materials: ["lime", "fertilizer", "chicken-litter", "compost", "gypsum"],
                driveType: "ground",
                features: [
                    "Ground-driven operation",
                    "85 cu. ft. hopper volume",
                    "10 ft. hopper length, 60 in. width",
                    "11L x 15, 8 ply tires",
                    "Low maintenance",
                    "No PTO required"
                ],
                farmSize: ["small", "medium"],
                specialUse: ["orchard"],
                budgetClass: "economy"
            },
            {
                name: "CU 50",
                category: "CU / Redhawk Ground Drive Spreader",
                capacity: 5,
                capacityCuFt: 108,
                materials: ["lime", "fertilizer", "chicken-litter", "compost", "gypsum"],
                driveType: "ground",
                features: [
                    "Ground-driven operation",
                    "108 cu. ft. hopper volume",
                    "8 ft. hopper length, 74 in. width",
                    "11L x 15, 8 ply tires",
                    "Low maintenance",
                    "No PTO required"
                ],
                farmSize: ["small", "medium"],
                specialUse: [],
                budgetClass: "economy"
            },
            {
                name: "CU 50F",
                category: "CU / Redhawk Ground Drive Spreader",
                capacity: 5,
                capacityCuFt: 177,
                materials: ["lime", "fertilizer", "chicken-litter", "compost", "gypsum"],
                driveType: "ground",
                features: [
                    "Ground-driven operation",
                    "177 cu. ft. hopper volume",
                    "10 ft. hopper length, 78 in. width",
                    "11L x 15, 8 ply tires",
                    "Flotation design",
                    "No PTO required"
                ],
                farmSize: ["small", "medium"],
                specialUse: [],
                budgetClass: "economy"
            },
            {
                name: "CU 80",
                category: "CU / Redhawk Ground Drive Spreader",
                capacity: 8,
                capacityCuFt: 177,
                materials: ["lime", "fertilizer", "chicken-litter", "compost", "gypsum"],
                driveType: "ground",
                features: [
                    "Ground-driven operation",
                    "177 cu. ft. hopper volume",
                    "10 ft. - 2 in. hopper length, 78 in. width",
                    "19L x 16.1, 10 ply tires",
                    "Heavy-duty construction",
                    "No PTO required"
                ],
                farmSize: ["medium", "large"],
                specialUse: [],
                budgetClass: "economy"
            },
            {
                name: "CU 100",
                category: "CU / Redhawk Ground Drive Spreader",
                capacity: 10,
                capacityCuFt: 212,
                materials: ["lime", "fertilizer", "chicken-litter", "compost", "gypsum"],
                driveType: "ground",
                features: [
                    "Ground-driven operation",
                    "212 cu. ft. hopper volume",
                    "12 ft. hopper length, 78 in. width",
                    "19L x 16.1, 10 ply tires",
                    "Heavy-duty construction",
                    "No PTO required"
                ],
                farmSize: ["medium", "large"],
                specialUse: [],
                budgetClass: "economy"
            },
            // WLS (Wet Lime Spreader) Series
            {
                name: "WLS 20",
                category: "Wet Lime Spreader",
                capacity: 2,
                capacityCuFt: 53,
                materials: ["lime", "fertilizer", "gypsum"],
                driveType: "hydraulic",
                features: [
                    "53 cu. ft. hopper volume",
                    "Ideal for wet lime applications",
                    "78 in. hopper length, 60 in. width",
                    "11L x 15, 8 ply tires",
                    "Single axle",
                    "Compact size"
                ],
                farmSize: ["small"],
                specialUse: ["wet-conditions", "orchard"],
                budgetClass: "mid"
            },
            {
                name: "WLS 40",
                category: "Wet Lime Spreader",
                capacity: 4,
                capacityCuFt: 84,
                materials: ["lime", "fertilizer", "gypsum"],
                driveType: "hydraulic",
                features: [
                    "84 cu. ft. hopper volume",
                    "Ideal for wet lime applications",
                    "120 in. hopper length, 60 in. width",
                    "11L x 15, 8 ply tires",
                    "Dual axles",
                    "Reliable performance"
                ],
                farmSize: ["small", "medium"],
                specialUse: ["wet-conditions", "orchard"],
                budgetClass: "mid"
            },
            {
                name: "WLS 50",
                category: "Wet Lime Spreader",
                capacity: 5,
                capacityCuFt: 103,
                materials: ["lime", "fertilizer", "gypsum"],
                driveType: "hydraulic",
                features: [
                    "103 cu. ft. hopper volume",
                    "Ideal for wet lime applications",
                    "96 in. hopper length, 74 in. width",
                    "11L x 15, 8 ply tires",
                    "Dual axles",
                    "Versatile capacity"
                ],
                farmSize: ["small", "medium"],
                specialUse: ["wet-conditions"],
                budgetClass: "mid"
            },
            {
                name: "WLS 50F",
                category: "Wet Lime Spreader",
                capacity: 5,
                capacityCuFt: 177,
                materials: ["lime", "fertilizer", "gypsum"],
                driveType: "hydraulic",
                features: [
                    "177 cu. ft. hopper volume",
                    "Ideal for wet lime applications",
                    "120 in. hopper length, 78 in. width",
                    "11L x 15, 8 ply tires",
                    "Dual axles",
                    "Flotation design"
                ],
                farmSize: ["small", "medium"],
                specialUse: ["wet-conditions"],
                budgetClass: "mid"
            },
            {
                name: "WLS 80",
                category: "Wet Lime Spreader",
                capacity: 8,
                capacityCuFt: 177,
                materials: ["lime", "fertilizer", "gypsum"],
                driveType: "hydraulic",
                features: [
                    "177 cu. ft. hopper volume",
                    "Ideal for wet lime applications",
                    "120 in. hopper length, 78 in. width",
                    "19L x 16.1, 10 ply tires",
                    "Dual axles",
                    "Heavy-duty construction"
                ],
                farmSize: ["medium", "large"],
                specialUse: ["wet-conditions"],
                budgetClass: "mid"
            },
            {
                name: "WLS 100",
                category: "Wet Lime Spreader",
                capacity: 10,
                capacityCuFt: 212,
                materials: ["lime", "fertilizer", "gypsum"],
                driveType: "hydraulic",
                features: [
                    "212 cu. ft. hopper volume",
                    "Ideal for wet lime applications",
                    "143 in. hopper length, 78 in. width",
                    "21.5L x 16.1, 14 ply tires",
                    "Dual axles",
                    "Large capacity operation"
                ],
                farmSize: ["medium", "large"],
                specialUse: ["wet-conditions"],
                budgetClass: "mid"
            },
            {
                name: "WLS 150",
                category: "Wet Lime Spreader",
                capacity: 15,
                capacityCuFt: 300,
                materials: ["lime", "fertilizer", "gypsum"],
                driveType: "hydraulic",
                features: [
                    "300 cu. ft. hopper volume",
                    "Ideal for wet lime applications",
                    "192 in. hopper length, 88 in. width",
                    "21.5L x 16.1, 14 ply tires",
                    "Dual axles",
                    "Maximum wet lime capacity"
                ],
                farmSize: ["large", "xlarge"],
                specialUse: ["wet-conditions"],
                budgetClass: "premium"
            },
            // BMS (Bulk Material Spreader) Series
            {
                name: "BMS 5010",
                category: "Bulk Material Spreader",
                capacity: 5,
                capacityCuFt: 137,
                materials: ["chicken-litter", "compost", "manure", "fertilizer", "biochar", "bulk"],
                driveType: "pto",
                features: [
                    "137 cu. ft. hopper volume",
                    "PTO driven",
                    "10 ft. hopper length, 74 in. width",
                    "11L x 15, 8 ply tires",
                    "Versatile bulk material handling",
                    "Ideal for poultry litter and compost"
                ],
                farmSize: ["small", "medium"],
                specialUse: [],
                budgetClass: "mid"
            },
            {
                name: "BMS 8016",
                category: "Bulk Material Spreader",
                capacity: 10,
                capacityCuFt: 225,
                materials: ["chicken-litter", "compost", "manure", "fertilizer", "biochar", "bulk"],
                driveType: "pto",
                features: [
                    "225 cu. ft. hopper volume",
                    "PTO driven",
                    "16 ft. hopper length, 74 in. width",
                    "19L x 16.1, 10 ply tires",
                    "Versatile bulk material handling",
                    "Heavy-duty construction"
                ],
                farmSize: ["medium", "large"],
                specialUse: [],
                budgetClass: "mid"
            },
            {
                name: "BMS 1516",
                category: "Bulk Material Spreader",
                capacity: 15,
                capacityCuFt: 225,
                materials: ["chicken-litter", "compost", "manure", "fertilizer", "biochar", "bulk"],
                driveType: "pto",
                features: [
                    "225 cu. ft. hopper volume",
                    "PTO driven",
                    "16 ft. hopper length, 74 in. width",
                    "21.5L x 16.1, 14 ply tires",
                    "Large capacity for commercial operations",
                    "Versatile bulk material handling"
                ],
                farmSize: ["large", "xlarge"],
                specialUse: [],
                budgetClass: "premium"
            },
            {
                name: "BMS 1520",
                category: "Bulk Material Spreader",
                capacity: 15,
                capacityCuFt: 400,
                materials: ["chicken-litter", "compost", "manure", "fertilizer", "biochar", "bulk"],
                driveType: "pto",
                features: [
                    "400 cu. ft. hopper volume",
                    "PTO driven",
                    "20 ft. hopper length, 84 in. width",
                    "21.5L x 16.1, 14 ply tires",
                    "Extra large capacity",
                    "Commercial grade operation"
                ],
                farmSize: ["large", "xlarge"],
                specialUse: [],
                budgetClass: "premium"
            },
            {
                name: "BMS 2020",
                category: "Bulk Material Spreader",
                capacity: 20,
                capacityCuFt: 400,
                materials: ["chicken-litter", "compost", "manure", "fertilizer", "biochar", "bulk"],
                driveType: "pto",
                features: [
                    "400 cu. ft. hopper volume",
                    "PTO driven",
                    "20 ft. hopper length, 84 in. width",
                    "600/50-22.5 tires",
                    "Maximum capacity for large operations",
                    "Heavy-duty commercial construction"
                ],
                farmSize: ["xlarge"],
                specialUse: [],
                budgetClass: "premium"
            },
            {
                name: "BMS 2020XL",
                category: "Bulk Material Spreader",
                capacity: 20,
                capacityCuFt: 700,
                materials: ["chicken-litter", "compost", "manure", "fertilizer", "biochar", "bulk"],
                driveType: "pto",
                features: [
                    "700 cu. ft. hopper volume",
                    "PTO driven",
                    "20 ft. hopper length, 102 in. width",
                    "600/50-22.5 tires",
                    "Extra-long design for improved flow",
                    "Maximum capacity"
                ],
                farmSize: ["xlarge"],
                specialUse: [],
                budgetClass: "premium"
            },
            // RC (Row Crop) Series
            {
                name: "RC8010",
                category: "Row Crop Spreader",
                capacity: 8,
                capacityCuFt: 177,
                materials: ["chicken-litter", "compost", "manure", "fertilizer", "biochar"],
                driveType: "pto",
                features: [
                    "177 cu. ft. hopper volume (53 deg. side slope)",
                    "Adjustable wheel track (72-120 in.)",
                    "10 ft. hopper length, 78 in. width",
                    "380/90R46 row crop tires (15 in. wide)",
                    "PTO driven",
                    "Designed for precision agriculture"
                ],
                farmSize: ["medium", "large"],
                specialUse: ["row-crop"],
                budgetClass: "premium"
            },
            {
                name: "RC8012",
                category: "Row Crop Spreader",
                capacity: 8,
                capacityCuFt: 331,
                materials: ["chicken-litter", "compost", "manure", "fertilizer", "biochar"],
                driveType: "pto",
                features: [
                    "331 cu. ft. hopper volume (45 deg. side slope)",
                    "Adjustable wheel track (72-120 in.)",
                    "12 ft. hopper length, 102 in. width",
                    "380/90R46 row crop tires (15 in. wide)",
                    "PTO driven",
                    "Extended design for better flow"
                ],
                farmSize: ["medium", "large"],
                specialUse: ["row-crop"],
                budgetClass: "premium"
            },
            {
                name: "RC1516",
                category: "Row Crop Spreader",
                capacity: 15,
                capacityCuFt: 300,
                materials: ["chicken-litter", "compost", "manure", "fertilizer", "biochar"],
                driveType: "pto",
                features: [
                    "300 cu. ft. hopper volume (53 deg. side slope)",
                    "Adjustable wheel track (90-152 in.)",
                    "16 ft. hopper length, 88 in. width",
                    "380/90R46 or 710/70R38 flotation tires (28 in. wide)",
                    "PTO driven",
                    "Large capacity for commercial operations"
                ],
                farmSize: ["large", "xlarge"],
                specialUse: ["row-crop"],
                budgetClass: "premium"
            },
            {
                name: "RC1520",
                category: "Row Crop Spreader",
                capacity: 15,
                capacityCuFt: 510,
                materials: ["chicken-litter", "compost", "manure", "fertilizer", "biochar"],
                driveType: "pto",
                features: [
                    "510 cu. ft. hopper volume (45 deg. side slope)",
                    "Adjustable wheel track (90-152 in.)",
                    "20 ft. hopper length, 102 in. width",
                    "380/90R46 or 710/70R38 flotation tires (28 in. wide)",
                    "PTO driven",
                    "Maximum row crop capacity"
                ],
                farmSize: ["large", "xlarge"],
                specialUse: ["row-crop"],
                budgetClass: "premium"
            },
            // NPB (Narrow Profile Bander) - Orchard/Vineyard Spreaders
            {
                name: "NPB 20",
                category: "NPB Narrow Profile Bander (Orchard/Vineyard)",
                capacity: 2,
                capacityCuFt: 53,
                materials: ["compost", "fertilizer", "manure", "lime"],
                driveType: "pto",
                features: [
                    "53 cu. ft. hopper volume",
                    "Narrow profile for orchards and vineyards",
                    "78 in. hopper length, 60 in. width",
                    "11L x 15, 8 ply tires",
                    "Single axle",
                    "Compact design fits between rows"
                ],
                farmSize: ["small", "medium"],
                specialUse: ["orchard"],
                budgetClass: "mid"
            },
            {
                name: "NPB 40",
                category: "NPB Narrow Profile Bander (Orchard/Vineyard)",
                capacity: 4,
                capacityCuFt: 84,
                materials: ["compost", "fertilizer", "manure", "lime"],
                driveType: "pto",
                features: [
                    "84 cu. ft. hopper volume",
                    "Narrow profile for orchards and vineyards",
                    "120 in. hopper length, 60 in. width",
                    "11L x 15, 8 ply tires",
                    "Dual axles",
                    "Increased capacity while maintaining compact design"
                ],
                farmSize: ["small", "medium"],
                specialUse: ["orchard"],
                budgetClass: "mid"
            }
        ];

        // Scoring algorithm
        function scoreAndRankSpreaders(formData) {
            // Filter out boom spreaders unless "boom-spreader" is explicitly selected
            const filteredSpreaders = spreaders.filter(spreader => {
                // If this spreader is boom-spreader-only, only show it when boom-spreader is selected
                if (spreader.boomSpreaderOnly) {
                    return formData.cropType === "boom-spreader";
                }
                // Show all other spreaders normally
                return true;
            });

            const scores = filteredSpreaders.map(spreader => {
                let score = 0;
                let maxScore = 0;

                // Farm size matching (weight: 20 points)
                maxScore += 20;
                if (formData.farmSize && spreader.farmSize.includes(formData.farmSize)) {
                    // Base score for farm size match
                    let farmSizeScore = 15;

                    // Add granular bonus based on how well capacity aligns with farm size expectations
                    const farmSizeCapacityMap = {
                        "small": { ideal: 3, min: 2, max: 5 },
                        "medium": { ideal: 6, min: 4, max: 8 },
                        "large": { ideal: 11, min: 8, max: 15 },
                        "xlarge": { ideal: 17, min: 15, max: 20 }
                    };

                    const sizeProfile = farmSizeCapacityMap[formData.farmSize];
                    if (sizeProfile) {
                        // Calculate how close the spreader's capacity is to the ideal for this farm size
                        const capacityDiff = Math.abs(spreader.capacity - sizeProfile.ideal);
                        const maxDiff = Math.max(sizeProfile.ideal - sizeProfile.min, sizeProfile.max - sizeProfile.ideal);
                        const capacityBonus = Math.max(0, 5 - (capacityDiff / maxDiff * 5));
                        farmSizeScore += capacityBonus;
                    }

                    score += farmSizeScore;
                } else if (formData.farmSize) {
                    // Partial credit for adjacent sizes
                    const sizeOrder = ["small", "medium", "large", "xlarge"];
                    const userIndex = sizeOrder.indexOf(formData.farmSize);
                    const spreaderSizes = spreader.farmSize.map(s => sizeOrder.indexOf(s));
                    const minDiff = Math.min(...spreaderSizes.map(i => Math.abs(i - userIndex)));
                    score += Math.max(0, 20 - (minDiff * 7));
                }

                // Material matching (weight: 25 points)
                maxScore += 25;
                if (formData.material && spreader.materials.includes(formData.material)) {
                    score += 25;
                }

                // Capacity matching (weight: 20 points)
                maxScore += 20;
                if (formData.capacity) {
                    const capacityRanges = {
                        "small": [2, 4],
                        "medium": [4, 8],
                        "large": [8, 15],
                        "xlarge": [15, 20]
                    };
                    const range = capacityRanges[formData.capacity];
                    if (range && spreader.capacity >= range[0] && spreader.capacity <= range[1]) {
                        // Give full points for being in range
                        let capacityScore = 15;

                        // Add granular bonus for being closer to the middle of the range
                        const rangeMid = (range[0] + range[1]) / 2;
                        const rangeSpan = range[1] - range[0];
                        const distanceFromMid = Math.abs(spreader.capacity - rangeMid);
                        const proximityBonus = Math.max(0, 5 - (distanceFromMid / rangeSpan * 5));
                        capacityScore += proximityBonus;

                        score += capacityScore;
                    } else if (range) {
                        // Partial credit based on how close
                        const diff = Math.min(
                            Math.abs(spreader.capacity - range[0]),
                            Math.abs(spreader.capacity - range[1])
                        );
                        score += Math.max(0, 20 - (diff * 3));
                    }
                }

                // Drive type matching (weight: 15 points)
                maxScore += 15;
                if (formData.driveType && spreader.driveType === formData.driveType) {
                    score += 15;
                } else if (!formData.driveType) {
                    score += 7.5; // Neutral score if no preference
                }

                // Special use matching (weight: 15 points)
                maxScore += 15;
                if (formData.cropType && spreader.specialUse.includes(formData.cropType)) {
                    score += 15;
                } else if (!formData.cropType || formData.cropType === "") {
                    score += 7.5; // Neutral score if no special requirement
                }

                // Budget matching (weight: 5 points)
                maxScore += 5;
                if (formData.budget && spreader.budgetClass === formData.budget) {
                    score += 5;
                } else if (!formData.budget) {
                    score += 2.5; // Neutral score if no preference
                }

                return {
                    spreader: spreader,
                    score: score,
                    percentage: Math.round((score / maxScore) * 100)
                };
            });

            // Sort by score descending
            scores.sort((a, b) => b.score - a.score);

            // Filter to only show matches above 30%
            return scores.filter(s => s.percentage >= 30);
        }

        // Display results
        function displayResults(rankedSpreaders) {
            const container = document.getElementById('resultsContainer');
            const resultsSection = document.getElementById('results');

            if (rankedSpreaders.length === 0) {
                container.innerHTML = '<div class="no-results">No spreaders found matching your criteria. Please adjust your requirements and try again.</div>';
                resultsSection.classList.add('active');
                resultsSection.scrollIntoView({ behavior: 'smooth' });
                return;
            }

            let html = '';
            rankedSpreaders.forEach((item, index) => {
                const s = item.spreader;
                const isTopMatch = index === 0;
                const cardClass = isTopMatch ? 'spreader-card top-match' : 'spreader-card';

                html += `
                    <div class="${cardClass}">
                        <h3>
                            ${s.name}
                            <span class="match-score">${item.percentage}% Match</span>
                            ${isTopMatch ? '<span class="match-score" style="background-color: #d4af37;">Best Match</span>' : ''}
                        </h3>
                        <div class="category">${s.category}</div>
                        <div class="specs">
                            <div class="spec-item"><span class="spec-label">Capacity:</span> ${s.capacity} tons (${s.capacityCuFt} cu. ft.)</div>
                            <div class="spec-item"><span class="spec-label">Drive Type:</span> ${s.driveType.toUpperCase()}</div>
                            <div class="spec-item"><span class="spec-label">Budget Class:</span> ${s.budgetClass.charAt(0).toUpperCase() + s.budgetClass.slice(1)}</div>
                        </div>
                        <div class="spec-item" style="margin-top: 10px;">
                            <span class="spec-label">Materials:</span> ${s.materials.map(m => m.replace('-', ' ')).join(', ')}
                        </div>
                        <div class="features">
                            <div class="features-title">Features:</div>
                            <ul>
                                ${s.features.map(f => `<li>${f}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            resultsSection.classList.add('active');
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Form submission
        document.getElementById('spreaderForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const formData = {
                farmSize: document.getElementById('farmSize').value,
                material: document.getElementById('material').value,
                capacity: document.getElementById('capacity').value,
                driveType: document.getElementById('driveType').value,
                cropType: document.getElementById('cropType').value,
                budget: document.getElementById('budget').value
            };

            // Check if at least one field is filled
            const hasSelection = Object.values(formData).some(val => val !== "");
            if (!hasSelection) {
                alert('Please select at least one requirement to find matching spreaders.');
                return;
            }

            const rankedSpreaders = scoreAndRankSpreaders(formData);
            displayResults(rankedSpreaders);
        });

        // Reset form
        function resetForm() {
            document.getElementById('spreaderForm').reset();
            document.getElementById('results').classList.remove('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>
